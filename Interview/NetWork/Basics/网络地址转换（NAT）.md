网络地址转换（Network Address Translation，NAT）是一种网络技术，用于*在私有网络和公共互联网之间映射IP地址*。其主要目的是允许多个设备在私有网络中**共享**一个或一组公共IP地址，从而有效地利用有限的公共IP地址资源。
## 原因
在私有网络中，通常使用[[IP 地址#预留地址|专门保留]]的IP地址范围，如10.0.0.0 到 10.255.255.255、172.16.0.0 到 172.31.255.255、192.168.0.0 到 192.168.255.255。这些地址是在互联网上**不可路由的**，因此不能直接用于公共互联网通信。
## 地址映射：
当内部网络的设备尝试访问互联网上的服务时，NAT设备将内部私有IP地址映射为其拥有的公共IP地址。这个映射关系被记录在NAT表中，以便在数据包传输过程中进行正确的转换。
### 1. 内部设备发送请求：
   内部网络中的设备（例如，局域网内的计算机）向外部网络（如互联网）发送请求。这个请求可能是访问网页、发送电子邮件等网络活动。
### 2. NAT设备检查请求：
   请求通过NAT设备的出口（连接到互联网的一侧）时，NAT设备会检查请求的源IP地址和端口号。
### 3. 创建映射表：
   如果NAT设备发现请求的源IP地址属于内部私有IP地址范围，并且与映射表中的已有映射不冲突，它将创建一个映射表项。映射表记录了内部私有IP地址、端口号与NAT设备的公共IP地址和分配的端口号之间的对应关系。
### 4. 分配公共IP地址和端口号：
   如果NAT设备在映射表中找到了对应的映射，它会分配一个公共IP地址和端口号，并替换请求中的源IP地址和端口号。这样，在互联网上看到的是NAT设备的公共IP地址和分配的端口号。
### 5. 发送请求到外部网络：
   使用新的公共IP地址和端口号，NAT设备将请求发送到外部网络。这样，内部设备的真实IP地址被隐藏，而只有NAT设备的公共IP地址和端口号在互联网上可见。
### 6. 外部网络响应：
   外部网络接收到请求后，将响应返回给NAT设备的公共IP地址和端口号。
### 7. NAT设备解析响应：
   收到响应后，NAT设备查找映射表，将响应中的目标IP地址和端口号替换为内部设备的真实IP地址和端口号。
### 8. 响应传递给内部设备：
   替换完成后，NAT设备将响应传递给内部设备。内部设备接收到响应，完成请求-响应过程。

## 端口映射（Port Address Translation，PAT）：
PAT是NAT的一种形式，通过使用端口号来区分多个设备共享同一个公共IP地址。PAT允许多个内部设备共享相同的公共IP地址，但通过不同的端口号来区分它们。

尽管NAT提供了一些好处，但也可能引入一些网络应用层的问题，例如影响特定协议的正确运行。因此，在设计网络时，需要仔细考虑NAT的使用场景和影响，并在需要时采用其他技术来满足特定需求。